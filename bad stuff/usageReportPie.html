<!--- for example: instrumentation usage report, 20% of the time is running, 80% is in idle -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Pie</title>
	<link href="flot.css" rel="stylesheet" type="text/css">
	<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../../excanvas.min.js"></script><![endif]-->
	<script language="javascript" type="text/javascript" src="flot/jquery.js"></script>
	<script language="javascript" type="text/javascript" src="flot/jquery.flot.js"></script>
	<script language="javascript" type="text/javascript" src="flot/jquery.flot.pie.js"></script>
	<script type="text/javascript">

	$(function() {

		// var json = some json object

		var json = '{ "data" : [' +
            '{ "label":"Running" , "data":20},' +
            '{ "label":"Idle" , "data":60},' +
            '{ "label":"Stalled" , "data":20}]}';

        var obj = JSON.parse(json);

		var data = [];
		for (var i = 0; i < obj.data.length; i++) {
			data.push(obj.data[i]);
		};

		console.log(data);

		plot = $.plot('#placeholder', data, {
		    series: {
		        pie: {
		            show: true,
		            radius: 1,
		            label: {
		                show: true,
		                radius: 3/4,
		                formatter: labelFormatter,
		                background: {
		                    opacity: 0.5
		                }
		            }
		        }
		    },
		    legend: {
		        show: false
		    }
		});


		$(window).resize(function() {

		    // redraw the graph in the correctly sized div
		    plot = $.plot('#placeholder', data, {
			    series: {
			        pie: {
			            show: true,
			            radius: 1,
			            label: {
			                show: true,
			                radius: 3/4,
			                formatter: labelFormatter,
			                background: {
			                    opacity: 0.5
			                }
			            }
			        }
			    },
			    legend: {
			        show: false
			    }
			});
		}

		);

		// Add the Flot version string to the footer

		//$("#footer").prepend("Flot " + $.plot.version + " &ndash; ");

		
	    var myCanvas = plot.getCanvas();
	    window.open(myCanvas.toDataURL("image/png"));
	});


 //    //Canvas2Image.saveAsPNG(myCanvas, 200, 200);
 //    var image = myCanvas.toDataURL("image/png").replace("image/png", "image/octet-stream");  /// here is the most important part because if you dont replace you will get a DOM 18 exception.
	// document.location.href=image;


	function labelFormatter(label, series) {
		return "<div style='font-size:8pt; text-align:center; padding:2px; color:white;'>" + label + "<br/>" + Math.round(series.percent) + "%</div>";
	}

	</script>
</head>
<body>

	<div id="header">
		<h2>Usage</h2>
	</div>

	<div id="content">

		<div class="demo-container">
			<div id="placeholder" class="demo-placeholder"></div>
		</div>

</body>
</html>